<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Email verified - Hear</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; display:flex; align-items:center; justify-content:center; min-height:100vh; margin:0; background:#f6f7fb; color:#102a43; padding:20px }
    .card{ background:white; padding:40px 32px; border-radius:12px; box-shadow: 0 6px 18px rgba(20,20,50,0.08); max-width:500px; width:100%; text-align:center }
    .logo { width:120px; height:auto; margin:0 auto 24px; display:block }
    h1 { margin:0 0 12px; font-size:24px; font-weight:600; color:#102a43 }
    .muted{ color:#445566; font-size:15px; line-height:1.6; margin:0 0 24px }
    button { background:#1E7078; color:#BEE7E8; border:none; padding:14px 28px; border-radius:8px; font-size:16px; font-weight:500; cursor:pointer; transition:all 0.2s }
    button:hover { background:#165A61; transform:translateY(-1px) }
    button:active { transform:translateY(0) }
    pre{ background:#f3f4f6; padding:12px; border-radius:6px; overflow:auto; font-size:12px; color:#445566; margin:20px 0 0; word-break:break-all }
    .help { margin-top:20px; font-size:13px; color:#7b8a95 }
  </style>
</head>
<body>
  <div class="card">
    <img src="https://eterdas1.github.io/hear-privacy/logo.png" alt="Hear" class="logo">
    <h1>You're verified âœ…</h1>
    <p class="muted">Welcome to Hear! Your email has been confirmed. Tap the button below to open the app and start learning languages with podcasts.</p>

    <div id="actions">
      <button id="openApp">Open App</button>
      <p class="help">If the app doesn't open automatically, copy the link below and paste it into your phone's browser:</p>
      <pre id="link">...</pre>
    </div>
  </div>

  <script>
    // This page expects Supabase to send the confirmation URL including token information
    // Example incoming URL formats:
    // 1) https://your-site/email_verified.html#access_token=...&type=signup
    // 2) https://your-site/email_verified.html?access_token=...&type=signup
    
    function buildAppDeepLink() {
      const hash = window.location.hash || '';
      const search = window.location.search || '';
      // Prefer fragment (hash) because Supabase may put tokens there
      const tokenPart = hash || search;
      // Build app deep link; keep the fragment if present
      const deep = 'hear://auth' + tokenPart;
      return deep;
    }

    const appLink = buildAppDeepLink();

    document.getElementById('link').textContent = appLink;
    document.getElementById('openApp').addEventListener('click', () => {
      // Try to open the app by navigating to the custom scheme
      window.location.href = appLink;
      // Also attempt a small delay then show instructions (some browsers block immediate app open)
      setTimeout(() => {
        // no-op; leaving user on the page if app failed to open
      }, 600);
    });

    // Auto-redirect for mobile users
    (function autoOpen() {
      const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
      if (isMobile) {
        // try auto-opening the app once
        window.location.href = appLink;
      }
    })();
  </script>
</body>
</html>
